# Proiect-AD
In the Omnet++ project, in the simulations folder, the MobileHost.ned file is used to define a node of the network.  A node is defined through a simple module which contains parameters which store data about it, like the id, the group of the node, the total number of nodes and the initial value. It has two gates, one for input and one for output, since nodes send and receive messages.
	The OpportunisticNetworks.ned file is used to define the opportunistic network. It is defined through a compound module made of an array of MobileHost instances and parameters like ID and group are submodules.
	The omnet.ini file is the configuration file where parameters can be set. It has two sections. The General section is for configuring the whole simulation, while the Config OpportunisticnNetwork section specifies parameters for the OpportunisticNetwork module. In this sections, parameters like Id and Group get a value. The nodeID parameter is designed to be an index.
	In the SRC folder, the algorithm is implemented. The MobileHost.h file is to define the MobileHost function. The class inherits the cSimpleModule class which is the base class for all the modules. In the private side, this class calls the ConsensusAlgorithm class. In the protected side, the functions initialize and handleMessage are declared. In the public side the MobileHost constructor is declared.
	In the MobileHost.cc file, an instance of the ConsensusAlgorithm class is made. It receives as parameters the index, the group ID and the number of total nodes. The par function is used to access the parameters from the modules and get their values. In this file, the initialise function is also written. This function receives the initial value of a node and  starts the session. It also schedules the first move. In this file, thewre is also the handleMessage function. This function receives a message using the *msg parameters and checks if itâ€™s a contribution or a decision. It uses the check_and_cast function to check if the casting of the msg pointer to the contribution message or decision message is good. This function receives the contribution or the decision, records the type of the message, the ID of the node and the value and pushes for a new round.
	In the ConsensusAlgorithm.h file, the ConsensusAlgorithm class is defined. It inherites the cSimpleModule. In this class, the id, groupId, nbNodes, solved, currentRound variables are declared. The contributions are stored in the contributions map and the Ids of the contributions in contributionIds. In this class, the publishContribution, publishDecision, genId, cancel, getInitialValue, getConsensuVCalue, allEqual, decide, startSession, startRound, receiveContribution, receiveDecision. The consensusAlgorithm construction is also declared.
	In the ConsensusAlgorithm function, the constructor is written and it gets nodeId, group and nodeCount as parameters. The startSession function is also written. It gets the initialValue and initialRound parameters and it starts the session, clears all the contributions, marks the consensus problem as unsolved and publishes the initial value of the current round. The startRound function exists the function when consensus is solved. If the consesnsus is not solved, it starts a new round, clearing  the contribution id. The receiveContribution function gets msgId, round and value as parameters. It exists the class if consensus is reached and if not, it checks if the round parameter corresponds to the current round. If yes, it checks if the condition of having contribution from at least two thirds of the nodes is reached and if yes, makes a decision and calls the StartRound function. The receiveDecision function calls the publishDecision function if consensus is reached. The publishContribution function sets the type of the message to contribution, the id, the value, the round and uses the send function to send the message to the MobileHost module. The publishDecision function stes the ID, the type of the message to decision, the value and sends the message to MobileHost. The genId function sets the Id. The cancel function has the purpose of cancelling a message. The get Consensus function receives the values of a round as parameter, counts the number of times each value appears and the value with the most appearances is the consensus value. The allequal function checks if all contributions are the same, thus checking if there is consensus. The decide function marks the consensus problem as solved and calls the publishDecision function.
